# 多面体编译
[基于多面体模型的编译“黑魔法”](https://www.jos.org.cn/html/2018/8/5563.htm)

## 概述
多面体模型通常利用迭代空间(domain)、访存映
射(write and read)、依赖关系(dependence)和调度(schedule)表示程序及其语义

线性整数规划：抽象分析，调度变换，代码生成

抽象分析：多面体编译工具的前端，从输入语言中识别并抽取满足多面体表示约束的程序段,将该程序段表示成多面体形式，并计算迭代空间和访存映射

调度变换：多面体编译工具的中间优化部分

代码生成：多面体编译工具的后端，第 1 阶段以迭代空间和调度为输入,借助线性整数规划过程生成抽象语法树;第 2 阶段则是根据目标程序语言规范将抽象语法树转变成最终代码

线性整数规划过程贯穿于多面体编译工具的整个流程，因为每个阶段最终都可以转化成线性整数规划问题的求解过程，多面体编译工具可以看作是一个多次重复解决线性整数规划问题（NP难问题）的过程

线性整数规划工具：isl,Omega, PIP, Polylib, PPL

## 程序并行性

### 依赖关系分析

依赖关系是实现程序自动并行化的基础

从循环嵌套内一个语句实例 S1 到另外一条语句实例 S2 之间存在依赖,必须满足 4 个条件:
1. S1 和 S2 访存同一地址单元
2. S1 和S2 之中至少有 1 个是向该地址单元写入数据
3. 存在一条从 S1 到 S2 的程序执行路径
4. S1 是所有满足前面 3个条件中程序执行路径离 S2 最近的一个语句实例

终写树:数据流分析进行了进一步优化

### 代码生成

代码生成并未对程序进行变换,因此不需要考虑依赖关系

代码生成的输入是调度变换阶段生成的调度以及程序原有的迭代空间

代码生成的任务就是将迭代空间上的每个点,按照调度指定的顺序和规则生成抽象语法树

代码生成的核心问题是如何生成每个循环的边界以及如何生成每个控制流的判定条件

聚合代码生成方法

分割代码生成方法

## 数据局部性

### 循环分块

循环分块是指通过增加循环嵌套的维度来提升数据局部性的循环变换技术

平行四边形分块

交叉分块和分裂分块

钻石分块

六角形分块

### 数组压缩

