# Data Flow Analysis

## Introduction

数据流分析的数学基础是离散数学中的半格,格; 是编译优化,代码生成的理论基础。

编译优化中求解数据流方程

## 离散基础

### 半格
半格(Semi-Lattices) 是二元组, 记为<S, ∩>, S表示集合, ∩表示二元关系交集

特性:
1. 幂等性: x ∩ x = x
2. 交换性: x ∩ y = y ∩ x
3. 结合性: x ∩ ( y ∩ z ) = ( x ∩ y) ∩ z

半格中最大下界: g < x, g < y 则g为x,y 的下界; 若z < x,y的任意下界, 则z 为x,y 的最大下界

半格中最小上界: 与半格中最大下界类似

#### 偏序集: <S, ≤>

特性:
1. 自反性
2. 反对称性
3. 传递性

### 格
<S, ∩, ∪> 三元组

完备格/完全格: <S, ∩, ∪> 当且仅当集合S中的任何一个子集都有最小上界和最大下界, 记为<S, ∩, ∪, Τ, ⊥>

### 不动点

f(x) = x, x 是 函数f 的不动点

最小不动点, 最大不动点

### 数据流分析

数据流分析是使用一种方法，用于获取有关数据沿着程序执行路径流动后的最终数据，通过数据流分析后获得的数据可以用于后续的编译优化等工作中

数据流分析是一种流敏感,路径不敏感的分析技术。流敏感指的是: 分析时考虑程序中语句的顺序;
路径不敏感: 指的是分析时不考虑路径实际的执行情况,认为路径都可以执行。

#### 数据流方程形式化描述

语句s执行前后数据流: In[s] OUT[s]
1. 基于语义约束
2. 基于控制流约束: 控制流图中存在顺序、分支和汇聚结点，所以转移函数还需要考虑不同类型结点是如何处理转换

数据流分析方向: 前向分析(或者正向传播, Forward)和后向分析(或者逆向传播,Backward)

计算程序中的活跃变量就是典型的后向分析, 活跃变量指的是一个变量从定义点(Def)到使用点(Use)之间的区间都是活跃

计算达到定值是前向分析

常量传播是前向分析

#### 数据流遍历性能分析

图的遍历: DFS, BFS; 前序遍历, 后序遍历, 逆后续遍历(PRO,保证访问节点的前驱节点已经全部访问,可用于拓扑排序)

前向数据流分析中,采用逆后序遍历可以加速不动点的求解速度, 后续节点的信息来自前驱节点,而前驱节点已全部访问。

DAG(有向无环图)的逆后序遍历就是拓扑排序

CFG(有向有环图)不存在拓扑排序结果,使用DFS序仍能减少有环图的迭代次数